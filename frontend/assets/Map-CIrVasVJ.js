import{j as t,e as s,f as c,r as d,C as N,ad as W,ae as A,af as k,a5 as B}from"./vendor-CY4U35Sj.js";const C=()=>t.jsxs(s,{sx:{position:"absolute",bottom:20,right:20,bgcolor:"white",p:2,borderRadius:2,boxShadow:3,minWidth:140,zIndex:1e3},children:[t.jsx(c,{variant:"subtitle1",fontWeight:"bold",sx:{mb:1},children:"ระดับน้ำ"}),t.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.5},children:[t.jsx(s,{sx:{width:18,height:18,bgcolor:"red",mr:1}}),t.jsx(c,{variant:"body2",children:"น้ำล้นตลิ่ง"})]}),t.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.5},children:[t.jsx(s,{sx:{width:18,height:18,bgcolor:"#003CFA",mr:1}}),t.jsx(c,{variant:"body2",children:"น้ำมาก"})]}),t.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.5},children:[t.jsx(s,{sx:{width:18,height:18,bgcolor:"#00B050",mr:1}}),t.jsx(c,{variant:"body2",children:"น้ำปกติ"})]}),t.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.5},children:[t.jsx(s,{sx:{width:18,height:18,bgcolor:"#FFA500",mr:1}}),t.jsx(c,{variant:"body2",children:"น้ำน้อย"})]}),t.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(s,{sx:{width:18,height:18,bgcolor:"#DB802B",mr:1}}),t.jsx(c,{variant:"body2",children:"น้ำน้อยวิกฤต"})]})]}),D=()=>{const[b,j]=d.useState([]),[p,v]=d.useState({}),[_,u]=d.useState(!0),[y,f]=d.useState(null),w=d.useRef();d.useEffect(()=>{(async()=>{u(!0);try{const i=await(await fetch("https://api-v3.thaiwater.net/api/v1/thaiwater30/api_service?mid=105&id4385&eid=wY8KK9_YFW3aeLpnXQLB0De3btJjcyoxM8zKFFpT9WcQqfVPhbhCQeuu44vwG2Jf77CDl9L2fWOK6plt1J1LJg")).json(),h=(Array.isArray(i)?i:[i]).filter(a=>a.tele_station_lat&&a.tele_station_long&&!isNaN(parseFloat(a.tele_station_lat))&&!isNaN(parseFloat(a.tele_station_long))).map(a=>{var m;return{id:a.id,name:((m=a.tele_station_name)==null?void 0:m.th)??"ไม่พบชื่อสถานี",lat:parseFloat(a.tele_station_lat),lon:parseFloat(a.tele_station_long),ground_level:a.ground_level??"-",left_bank:a.left_bank??"-",right_bank:a.right_bank??"-"}});j(h);const o=await(await fetch("https://api-v3.thaiwater.net/api/v1/thaiwater30/api_service?mid=103&id3006&eid=QJ1OFmBwdvsdn29HAUarfl-0eXLah0ggaH24hF32H839vXDb-7FHFV36Ms78IHuTKFaNtlNBSZxTvNo2RLn2pw")).json(),n=Array.isArray(o)?o:[o],g={};n.forEach(a=>{g[a.tele_station_id]={waterlevel_datetime:a.waterlevel_datetime,waterlevel_msl:a.waterlevel_msl}}),v(g)}catch(r){console.error(r)}finally{u(!1)}})()},[]);const F=b.filter(e=>{const r=p[e.id],i=r&&r.waterlevel_msl!==void 0&&r.waterlevel_msl!==null,l=e.left_bank!==void 0&&e.left_bank!=="-"&&e.left_bank!==null,h=e.right_bank!==void 0&&e.right_bank!=="-"&&e.right_bank!==null;return i&&l&&h});function S(e,r,i){if(e==null||isNaN(e)||r===null||r===void 0||isNaN(r)||i===null||i===void 0||isNaN(i))return{text:"-",color:"inherit"};const l=parseFloat(r),h=parseFloat(i),x=Math.min(l,h),o=parseFloat(e);if(o>x)return{text:"ล้นตลิ่ง",color:"red"};const n=o/x*100;return n<=10?{text:"น้อยวิกฤต",color:"#DB802B"}:n>10&&n<=30?{text:"น้อย",color:"#FFA500"}:n>30&&n<=70?{text:"ปกติ",color:"#00B050"}:n>70&&n<=100?{text:"มาก",color:"#003CFA"}:{text:"-",color:"inherit"}}const L=[13.7563,100.5018];return _?t.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:t.jsx(N,{})}):t.jsx(s,{sx:{width:"100vw",height:"100vh"},children:t.jsxs(W,{ref:w,center:L,zoom:6,minZoom:6,style:{height:"100%",width:"100%"},children:[t.jsx(A,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),F.map(e=>{const r=p[e.id],{text:i,color:l}=S(r==null?void 0:r.waterlevel_msl,e.left_bank,e.right_bank);return t.jsx(k,{center:[e.lat,e.lon],radius:6,pathOptions:{color:l,fillColor:l,fillOpacity:.6},eventHandlers:{click:()=>f(e.id)},children:y===e.id&&t.jsx(B,{onClose:()=>f(null),children:t.jsxs("div",{children:[t.jsx("strong",{children:e.name}),t.jsx("br",{}),"สถานการณ์น้ำ:"," ",t.jsxs("span",{style:{color:l,fontWeight:600},children:["น้ำ",i]}),t.jsx("br",{}),"ระดับน้ำ: ",(r==null?void 0:r.waterlevel_msl)??"-"," (ม.รทก)",t.jsx("br",{}),"ระดับท้องน้ำ: ",e.ground_level??"-"," (ม.รทก)",t.jsx("br",{}),"ระดับตลิ่งซ้าย: ",e.left_bank," (ม.รทก)",t.jsx("br",{}),"ระดับตลิ่งขวา: ",e.right_bank," (ม.รทก)"]})})},e.id)}),t.jsx(C,{})]})})};export{D as default};
