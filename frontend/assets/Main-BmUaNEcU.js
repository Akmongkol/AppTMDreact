import{j as t,e as j,an as S,f,ao as H,ap as w,aq as $,ar as m,as as r,at as E,au as O,l as p,av as k,aw as M,ax as W,y as z,r as g,ag as B,S as F,n as N}from"./vendor-CY4U35Sj.js";function Y({rows:i,displayDate:d}){return t.jsx(j,{sx:{display:"flex",justifyContent:"center",mt:2},children:t.jsxs(S,{sx:{width:"fit-content",p:2},elevation:3,children:[t.jsx(f,{variant:"h6",sx:{mb:1,textAlign:"center"},children:"รายงานสถานีอุตุนิยมวิทยาที่มีปริมาณฝนรายวันมากกว่า 35 มม."}),t.jsx(f,{variant:"subtitle1",color:"text.secondary",sx:{mb:2,textAlign:"center"},children:d}),t.jsx(H,{sx:{display:"flex",justifyContent:"center"},children:t.jsxs(w,{size:"small",sx:{width:"auto","& .MuiTableCell-root":{border:"1px solid rgba(224, 224, 224, 1)"}},children:[t.jsx($,{children:t.jsxs(m,{children:[t.jsx(r,{sx:{fontWeight:"bold"},children:"สถานี"}),t.jsx(r,{align:"right",sx:{fontWeight:"bold"},children:"ฝน (มม.)"})]})}),t.jsx(E,{children:i.length===0?t.jsx(m,{children:t.jsx(r,{colSpan:3,align:"center",children:"ไม่มีสถานีที่ฝนเกิน 35 มม."})}):i.map(e=>t.jsxs(m,{children:[t.jsxs(r,{children:[e.stationName," (",e.stationId,")"]}),t.jsx(r,{align:"right",children:e.rainfall})]},e.stationId))})]})})]})})}const D={borderBottom:"1px solid #d0d4d9",borderRight:"1px solid #d0d4d9",verticalAlign:"top",whiteSpace:"nowrap",color:"#1f2328",padding:{xs:"8px 12px",sm:"12px 16px"},fontSize:{xs:"0.813rem",sm:"0.875rem"},"&:last-child":{borderRight:"none"}},C={backgroundColor:"#f4f6f8",fontWeight:600,color:"#2c2f33",borderBottom:"1.5px solid #b0b6bc",borderRight:"1px solid #d0d4d9",whiteSpace:"nowrap",padding:{xs:"10px 12px",sm:"12px 16px"},fontSize:{xs:"0.875rem",sm:"0.938rem"},"&:last-child":{borderRight:"none"}};function P({rows:i}){function d(e){const a=new Date(e);return a.setDate(a.getDate()+1),a.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}return t.jsx(j,{sx:{display:"flex",justifyContent:"center",p:{xs:1,sm:2}},children:t.jsxs(S,{elevation:2,sx:{width:"fit-content",maxWidth:"100%",minWidth:{xs:"95%",sm:"auto"},p:2},children:[t.jsx(f,{variant:"h6",sx:{textAlign:"center"},children:"ปริมาณฝน 24 ชม. ย้อนหลัง 7 วัน"}),t.jsx(j,{sx:{px:{xs:2,sm:3,md:4},py:{xs:2,sm:2.5,md:3},display:"flex",justifyContent:"center"},children:t.jsx(H,{sx:{width:"fit-content"},children:t.jsxs(w,{sx:{tableLayout:"auto",width:"auto",border:"1px solid #b0b6bc",borderCollapse:"collapse"},children:[t.jsx($,{children:t.jsxs(m,{children:[t.jsx(r,{sx:C,children:"สถานี"}),t.jsx(r,{sx:C,align:"center",children:"ฝน 24 ชม. (มม.)"}),t.jsx(r,{sx:C,align:"center",children:"วันที่"})]})}),t.jsx(E,{children:i.length===0?t.jsx(m,{children:t.jsx(r,{colSpan:3,align:"center",children:"ไม่มีสถานีที่ฝนเกิน 35 มม."})}):i.map((e,a)=>{const o=a===0||i[a-1].stationId!==e.stationId;return t.jsxs(m,{hover:!0,sx:{borderTop:o?"2px solid #b0b6bc":"none","&:hover":{backgroundColor:"#f5f8fa"}},children:[t.jsxs(r,{sx:D,children:[t.jsx("strong",{children:e.stationName}),t.jsx("br",{}),t.jsxs(f,{variant:"caption",sx:{fontSize:{xs:"0.75rem",sm:"0.813rem"},color:"#586069"},children:["(",e.stationId,")"]})]}),t.jsx(r,{align:"center",sx:D,children:e.rainfall}),t.jsx(r,{align:"center",sx:D,children:d(e.recordTime)})]},`${e.stationId}-${e.recordTime}-${a}`)})})]})})})]})})}O(p);k(p);M(p);W(p);p.setOptions({time:{useUTC:!1}});function q({rows:i}){if(!(i!=null&&i.length))return null;const d=Object.values(i.reduce((a,o)=>{const c=o.stationId,y=Number(o.rainfall),x=new Date(o.recordTime);x.setDate(x.getDate()+1),x.setHours(0,0,0,0);const b=x.getTime();return a[c]||(a[c]={name:o.stationName,data:[]}),!Number.isNaN(b)&&!Number.isNaN(y)&&a[c].data.push([b,y]),a},{}));d.forEach(a=>{a.data.sort((o,c)=>o[0]-c[0])});const e={chart:{type:"line",zoomType:"x"},title:{text:"ปริมาณฝนย้อนหลัง 7 วัน"},xAxis:{type:"datetime",tickInterval:24*3600*1e3,title:{text:"วันที่"},labels:{formatter:function(){return new Date(this.value).toLocaleDateString("th-TH",{day:"numeric",month:"short"})}}},yAxis:{min:0,title:{text:"ปริมาณฝน (มม.)"}},legend:{enabled:!0,align:"center",verticalAlign:"bottom"},tooltip:{shared:!1,formatter:function(){return`
      <b>${new Date(this.x).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"})}</b><br/>
      <span style="color:${this.color}">●</span>
      ${this.series.name}: <b>${this.y} มม.</b>
    `}},plotOptions:{line:{marker:{enabled:!0},dataLabels:{enabled:!0,format:"{y} มม."}}},accessibility:{enabled:!0},exporting:{enabled:!0,fallbackToExportServer:!1},credits:{enabled:!1},series:d};return t.jsx(S,{sx:{p:1},children:t.jsx(z,{highcharts:p,options:e})})}function J(){const[i,d]=g.useState([]),[e,a]=g.useState([]),[o,c]=g.useState(!0),[y,x]=g.useState("");function b(){const l=new Date,n=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate(),0,0,0));return n.setUTCHours(n.getUTCHours()-7),n.setUTCDate(n.getUTCDate()-1),n.toISOString().slice(0,10)}function A(){const l=new Date,n=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate(),0,0,0));n.setUTCHours(n.getUTCHours()-7);const v=n.getUTCDate(),I=n.toLocaleString("th-TH",{month:"long",timeZone:"UTC"}),h=n.getUTCFullYear()+543;return`ณ วันที่ ${v} ${I} ${h}`}return g.useEffect(()=>{async function l(){try{const n=b();x(A());const h=((await N.get("https://wxmap.tmd.go.th/api/raindaily",{params:{DateTime:n}})).data.items||[]).filter(s=>s.rainfall!==null&&s.rainfall!==""&&s.rainfall>35).sort((s,u)=>u.rainfall-s.rainfall);if(d(h),h.length===0){a([]);return}const R={},T={};h.forEach((s,u)=>{R[s.stationId]=s.stationName,T[s.stationId]=u});const L=h.map(s=>s.stationId),U=((await N.get("https://wxmap.tmd.go.th/api/rain-7days",{params:{stationIds:L.join(",")}})).data.items||[]).map(s=>({...s,stationName:R[s.stationId]||"-"}));U.sort((s,u)=>T[s.stationId]-T[u.stationId]),a(U)}catch(n){console.error("โหลดข้อมูลไม่สำเร็จ",n)}finally{c(!1)}}l()},[]),o?t.jsx(j,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(f,{children:"กำลังโหลดข้อมูล..."})}):t.jsx(B,{maxWidth:!1,disableGutters:!0,sx:{minHeight:"100vh",px:{xs:1,sm:2,md:3},py:2},children:t.jsxs(F,{spacing:4,children:[t.jsx(Y,{rows:i,displayDate:y}),t.jsx(q,{rows:e}),t.jsx(P,{rows:e})]})})}export{J as default};
