import{j as e,e as s,f as d,r as a,S as z,I as F,ay as se,az as le,aA as G,aB as J,Z as ie,_ as ae,$,i as ce,a0 as de,aC as xe,aD as ue,aE as he,aF as pe,aG as A,A as fe,T as me,F as w,G as _,an as ge,aH as be,aI as E,aJ as L,aK as je,aL as U,aM as ye,g as B,C as Se,aN as we,b as Ce,d as ve,ad as ke,af as ze,a5 as _e,n as Ne}from"./vendor-CY4U35Sj.js";import{t as I,a as Ie}from"./th-DMVESbt-.js";const T=r=>r==null||r===0?{color:"#9e9e9e",label:"ไม่มีฝน"}:r>250?{color:"#7B0072",label:"ฝนตกหนักมาก"}:r>=125?{color:"#F00000",label:"ฝนตกหนัก"}:r>=65?{color:"#F49500",label:"ฝนตกค่อนหนัก"}:r>=35?{color:"#E9E700",label:"ฝนตกปานกลาง"}:r>=10?{color:"#C4F5C9",label:"ฝนตกเล็กน้อย"}:r>=.1?{color:"#F4F4F4",label:"ฝนประปราย"}:{color:"#9e9e9e",label:"ไม่มีฝน"},O=r=>r==null||isNaN(r)?{color:"#9e9e9e",label:"ไม่มีข้อมูล"}:r>=40?{color:"#d32f2f",label:"อากาศร้อนจัด"}:r>=35?{color:"#ff9800",label:"อากาศร้อน"}:r>=30?{color:"#ffeb3b",label:"อากาศปกติ"}:r>=16?{color:"#81d4fa",label:"อากาศเย็น"}:r>=8?{color:"#1565c0",label:"อากาศหนาว"}:{color:"#0041FF",label:"อากาศหนาวจัด"};function Fe(){const r=[{label:"ฝนตกหนักมาก (> 250 มม.)",color:"#7B0072"},{label:"ฝนตกหนัก (125 – 250 มม.)",color:"#F00000"},{label:"ฝนตกค่อนหนัก (65 – 125 มม.)",color:"#F49500"},{label:"ฝนตกปานกลาง (35 – 65 มม.)",color:"#E9E700"},{label:"ฝนตกเล็กน้อย (10 – 35 มม.)",color:"#C4F5C9"},{label:"ฝนประปราย (0.1 – 10 มม.)",color:"#F4F4F4"},{label:"ไม่มีฝน",color:"#9e9e9e"}];return e.jsxs(s,{children:[e.jsx(d,{variant:"subtitle2",fontWeight:"bold",mb:1,children:"เกณฑ์ปริมาณฝน"}),r.map(t=>e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.8},children:[e.jsx(s,{sx:{width:14,height:14,borderRadius:"50%",bgcolor:t.color,mr:1.2,border:"1px solid #555"}}),e.jsx(d,{variant:"body2",children:t.label})]},t.label))]})}function De(){const r=[{label:"อากาศหนาวจัด (≤ 7.9 °C)",color:"#0041FF"},{label:"อากาศหนาว (8.0 – 15.9 °C)",color:"#1565c0"},{label:"อากาศเย็น (16.0 – 29.9 °C)",color:"#81d4fa"},{label:"อากาศปกติ (30.0 – 34.9 °C)",color:"#ffeb3b"},{label:"อากาศร้อน (35.0 – 39.9 °C)",color:"#ff9800"},{label:"อากาศร้อนจัด (≥ 40.0 °C)",color:"#d32f2f"},{label:"ไม่มีข้อมูล",color:"#9e9e9e"}];return e.jsxs(s,{children:[e.jsx(d,{variant:"subtitle2",fontWeight:"bold",mb:1,children:"เกณฑ์อุณหภูมิอากาศ"}),r.map(t=>e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:.8},children:[e.jsx(s,{sx:{width:14,height:14,borderRadius:"50%",backgroundColor:t.color,mr:1.2,border:"1px solid #555"}}),e.jsx(d,{variant:"body2",children:t.label})]},t.label))]})}function Ee({mode:r,isMobile:t}){const[n,o]=a.useState(!t);return a.useEffect(()=>{o(!t)},[t]),e.jsxs(s,{sx:{position:"absolute",left:16,bottom:t?"calc(env(safe-area-inset-bottom, 0px) + 92px)":40,zIndex:1e3,bgcolor:"rgba(255,255,255,0.95)",borderRadius:2,boxShadow:3},children:[e.jsxs(z,{direction:"row",alignItems:"center",justifyContent:"space-between",px:1.5,py:.8,children:[e.jsx(d,{fontSize:13,fontWeight:600,children:"คำอธิบาย"}),e.jsx(F,{size:"small",onClick:()=>o(l=>!l),children:n?e.jsx(se,{fontSize:"small"}):e.jsx(le,{fontSize:"small"})})]}),e.jsx(G,{in:n,timeout:"auto",children:e.jsxs(s,{px:1.5,pb:1,children:[r==="rain"&&e.jsx(Fe,{}),r==="temp"&&e.jsx(De,{})]})})]})}const P=({size:r=14})=>e.jsx("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C12 2 5 10 5 14a7 7 0 0 0 14 0c0-4-7-12-7-12z"})}),Le=({size:r=14})=>e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m12 14 4-4"}),e.jsx("path",{d:"m3.34 7 1.66 1.66"}),e.jsx("path",{d:"m19 19-1.66-1.66"}),e.jsx("path",{d:"M12 4V2"}),e.jsx("path",{d:"M12 22v-2"})]}),Te=({size:r=14})=>e.jsxs("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 12h13a3 3 0 1 0-3-3"}),e.jsx("path",{d:"M3 18h9a3 3 0 1 1-3 3"})]}),V=({size:r=14})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2a1 1 0 0 1 .932.638l7 18a1 1 0 0 1-1.326 1.281L13 19.517V13a1 1 0 1 0-2 0v6.517l-5.606 2.402a1 1 0 0 1-1.326-1.281l7-18A1 1 0 0 1 12 2Z"})});function Oe({station:r,getTemperatureInfo:t,getRainInfo:n}){const o=r,l=t(o.temperature),i=n(o.precip_today);function m(h){if(!h)return"ไม่มีข้อมูลเวลา";const u=new Date(h);if(isNaN(u.getTime()))return"รูปแบบเวลาไม่ถูกต้อง";const b=u.getDate(),p=u.getMonth()+1,f=u.getFullYear()+543,j=String(u.getHours()).padStart(2,"0"),C=String(u.getMinutes()).padStart(2,"0"),y=String(u.getSeconds()).padStart(2,"0");return`วันที่ ${b}/${p}/${f} เวลา ${j}:${C}:${y} น.`}const x=i.label==="ฝนประปราย";return e.jsxs("div",{className:"weather-card",children:[e.jsxs("div",{className:"weather-card-header",children:[e.jsx("h2",{children:o.station_name_th}),e.jsx("p",{children:m(o.datetime_utc7)})]}),e.jsxs("div",{className:"weather-main-temp",children:[e.jsxs("div",{children:[e.jsx("p",{className:"label",children:"อุณหภูมิปัจจุบัน"}),e.jsxs("p",{className:"temp-value",style:{color:l.color},children:[o.temperature??"-","°C"]}),e.jsx("p",{style:{display:"inline-flex",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"5px",fontSize:"12px",fontWeight:500,color:l.color,backgroundColor:`${l.color}22`,border:`1px solid ${l.color}55`,marginTop:"4px",lineHeight:1.2,whiteSpace:"nowrap"},children:l.label})]}),e.jsxs("div",{className:"temp-range",children:[e.jsxs("div",{children:[e.jsx("p",{className:"label small",children:"อุณหภูมิสูงสุด"}),e.jsxs("p",{className:"temp-max",children:[o.temperature_max_today??"-","°C"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"label small",children:"อุณหภูมิต่ำสุด"}),e.jsxs("p",{className:"temp-min",children:[o.temperature_min_today??"-","°C"]})]})]})]}),e.jsxs("div",{className:"weather-rain",children:[e.jsxs("div",{className:"rain-left",children:[e.jsx("div",{className:"icon-box",children:e.jsx(P,{})}),e.jsxs("div",{children:[e.jsx("p",{className:"label small",children:"ฝนสะสม 15 นาที"}),e.jsxs("p",{className:"rain-main",children:[o.precip_15mins??0," มม."]}),e.jsxs("p",{style:{position:"absolute",left:0,bottom:-28,display:"inline-flex",alignItems:"center",padding:"8px 10px",borderRadius:"5px",fontSize:"12px",lineHeight:.2,fontWeight:500,whiteSpace:"nowrap",color:x?"#000000":i.color,backgroundColor:x?"#e0e0e0":`${i.color}22`,border:x?"1px solid #bdbdbd":`1px solid ${i.color}55`},children:["วันนี้: ",i.label]})]})]}),e.jsxs("div",{className:"rain-right",children:[e.jsx("p",{className:"label small",children:"ฝนสะสมวันนี้ (ตั้งแต่07:00 น.)"}),e.jsxs("p",{className:"rain-today",children:[o.precip_today??"-"," มม."]})]})]}),e.jsxs("div",{className:"weather-grid",children:[e.jsx(R,{icon:e.jsx(Te,{}),label:"ทิศทางลม",value:e.jsxs("span",{className:"wind-value",children:[Number.isFinite(o.winddirection)&&e.jsx("span",{className:"wind-arrow",style:{transform:`rotate(${(o.winddirection+180)%360}deg)`},children:e.jsx(V,{})}),e.jsxs("span",{children:[o.windspeed??"-"," กม./ชม."]})]})}),e.jsx(R,{icon:e.jsx(Le,{}),label:"ความกดอากาศ",value:`${o.pressure??"-"} hPa`}),e.jsx(R,{icon:e.jsx(P,{}),label:"ความชื้น",value:`${o.humidity??"-"} %`})]}),e.jsx("div",{className:"weather-card-footer",children:e.jsx(J,{to:`/awsmap/stations/${o.station_id}`,target:"_blank",children:"ดูข้อมูลสถานีเพิ่มเติม →"})})]})}function R({icon:r,label:t,value:n}){return e.jsxs("div",{className:"weather-grid-item",children:[e.jsx("div",{className:"grid-icon",children:r}),e.jsx("p",{className:"label small",children:t}),e.jsx("div",{className:"grid-value",children:n})]})}function Re({displayMode:r,setDisplayMode:t,open:n,setOpen:o}){return e.jsxs(ie,{ariaLabel:"เลือกการแสดงผล",open:n,onOpen:()=>{},onClose:()=>{},onClick:()=>o(l=>!l),sx:{position:"absolute",top:16,right:16,zIndex:1e3,"& .MuiSpeedDialAction-staticTooltipLabel":{backgroundColor:"rgba(97,97,97,0.95)",color:"#fff",whiteSpace:"nowrap",fontSize:"14px",borderRadius:"8px",padding:"6px 12px",boxShadow:3},"& .MuiSpeedDial-fab":{background:"linear-gradient(135deg, #334155, #1e293b)",color:"#fff",boxShadow:6,transition:"all 0.25s ease","&:hover":{background:"linear-gradient(135deg, #1e293b, #0f172a)",boxShadow:10}}},direction:"down",icon:e.jsx(ae,{}),children:[e.jsx($,{icon:e.jsx(ce,{}),tooltipTitle:e.jsx(d,{sx:{whiteSpace:"nowrap",fontSize:14},children:"ปริมาณฝน"}),tooltipOpen:!0,onClick:l=>{l.stopPropagation(),t("rain")},FabProps:{sx:r==="rain"?{background:"linear-gradient(135deg, #334155, #1e293b)",color:"#fff",boxShadow:6,"&:hover":{background:"linear-gradient(135deg, #1e293b, #0f172a)"}}:{backgroundColor:"#fff",color:"text.primary",border:"2px solid",borderColor:"divider",boxShadow:1,"&:hover":{backgroundColor:"grey.100"}}}}),e.jsx($,{icon:e.jsx(de,{}),tooltipTitle:e.jsx(d,{sx:{whiteSpace:"nowrap",fontSize:14},children:"อุณหภูมิ"}),tooltipOpen:!0,onClick:l=>{l.stopPropagation(),t("temp")},FabProps:{sx:r==="temp"?{background:"linear-gradient(135deg, #334155, #1e293b)",color:"#fff",boxShadow:6,"&:hover":{background:"linear-gradient(135deg, #1e293b, #0f172a)"}}:{backgroundColor:"#fff",color:"text.primary",border:"2px solid",borderColor:"divider",boxShadow:1,"&:hover":{backgroundColor:"grey.100"}}}})]})}function H({lastUpdated:r,loading:t,onRefresh:n}){return e.jsx(s,{sx:{display:"inline-flex",width:"fit-content",backgroundColor:"rgba(255,255,255,0.95)",borderRadius:2,boxShadow:3,px:2,py:1},children:e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(xe,{fontSize:"small",color:"action"}),e.jsxs(s,{sx:{fontSize:13},children:["ข้อมูล: ",e.jsx("strong",{children:r?r.toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"})]}),e.jsx(F,{onClick:n,disabled:t,size:"small",sx:{border:"1px solid",borderColor:"divider",bgcolor:"white"},children:e.jsx(ue,{fontSize:"small"})})]})})}function Me({isMobile:r,mobileSearchOpen:t,setMobileSearchOpen:n,lastUpdated:o,loading:l,onRefresh:i,regions:m,selectedRegion:x,setSelectedRegion:h,filteredProvinces:u,selectedProvince:b,setSelectedProvince:p}){return e.jsxs(e.Fragment,{children:[r&&e.jsxs(z,{direction:"row",spacing:1,sx:{position:"absolute",top:16,left:16,zIndex:1100,alignItems:"center"},children:[e.jsx(F,{onClick:()=>n(f=>!f),sx:{bgcolor:"white",boxShadow:3,"&:hover":{bgcolor:"grey.100"}},children:e.jsx(he,{})}),e.jsx(H,{lastUpdated:o,loading:l,onRefresh:i})]}),(!r||t)&&e.jsx(s,{sx:{position:"absolute",top:r?72:16,left:10,zIndex:1e3,width:"fit-content",maxWidth:"calc(100vw - 20px)"},children:e.jsxs(z,{direction:"column",spacing:1,alignItems:"flex-start",children:[!r&&e.jsx(H,{lastUpdated:o,loading:l,onRefresh:i}),e.jsxs(z,{direction:r?"column":"row",spacing:1,alignItems:"flex-start",children:[e.jsxs(pe,{size:"medium",value:x,onChange:f=>{h(f.target.value),p(null)},displayEmpty:!0,sx:{width:r?"100%":"fit-content",minWidth:200,backgroundColor:"white"},children:[e.jsx(A,{value:"",children:"ทั่วประเทศ"}),m.map(f=>e.jsx(A,{value:f,children:f},f))]}),e.jsx(fe,{size:"medium",options:u,value:b,onChange:(f,j)=>p(j),sx:{width:"fit-content",minWidth:220,backgroundColor:"white",borderRadius:1},renderInput:f=>e.jsx(me,{...f,label:"เลือกจังหวัด",sx:{width:"fit-content",minWidth:220}})})]})]})})]})}const Z={osm:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap"},esri:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles © Esri"},carto:{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap © CARTO"}};function We({basemap:r}){const t=w(),n=a.useRef(null);return a.useEffect(()=>{if(!t)return;n.current&&t.removeLayer(n.current);const o=_.tileLayer(Z[r].url,{attribution:Z[r].attribution});return o.addTo(t),n.current=o,()=>{t&&n.current&&t.removeLayer(n.current)}},[t,r]),null}function $e({basemap:r,setBasemap:t,isMobile:n}){const[o,l]=a.useState(!1);return e.jsxs(s,{sx:{position:"absolute",bottom:n?"calc(env(safe-area-inset-bottom, 0px) + 92px)":40,right:16,zIndex:1e3},children:[e.jsx(G,{in:o,collapsedSize:0,unmountOnExit:!0,sx:{position:"absolute",bottom:45,right:0},children:e.jsx(ge,{elevation:6,sx:{mb:1,borderRadius:2},children:e.jsxs(be,{dense:!0,children:[e.jsx(E,{selected:r==="osm",onClick:()=>{t("osm"),l(!1)},children:e.jsx(L,{primary:"OpenStreetMap"})}),e.jsx(E,{selected:r==="esri",onClick:()=>{t("esri"),l(!1)},children:e.jsx(L,{primary:"Esri_WorldStreetMap"})}),e.jsx(E,{selected:r==="carto",onClick:()=>{t("carto"),l(!1)},children:e.jsx(L,{primary:"CartoDB_Positron"})})]})})}),e.jsx(F,{onClick:()=>l(i=>!i),sx:{backgroundColor:"white",boxShadow:3,"&:hover":{backgroundColor:"#f5f5f5"}},children:e.jsx(je,{})})]})}function Ae({stations:r,selectedProvince:t}){const n=w();return a.useEffect(()=>{if(!t)return;const o=r.filter(m=>m.province_name_th===t);if(o.length===0)return;const{station_lat:l,station_lon:i}=o[0];n.flyTo([l,i],8,{duration:1})},[t,r,n]),null}function Be({stations:r,selectedRegion:t,selectedProvince:n,isMobile:o}){const l=w(),i=[13.7563,100.5018],m=o?5.3:6;return a.useEffect(()=>{if(n)return;if(!t){l.setView(i,m);return}const x=r.filter(u=>u.region_name_th===t);if(x.length===0)return;const h=_.latLngBounds(x.map(u=>[u.station_lat,u.station_lon]));l.fitBounds(h,{padding:[40,40],animate:!0,duration:1.2})},[t,n,r,l]),null}function Pe({selectedRegion:r}){const t=w(),n=a.useRef(null);return a.useEffect(()=>{if(n.current&&(t.removeLayer(n.current),n.current=null),!r)return;const l={type:"FeatureCollection",features:U(I,I.objects.data).features.filter(m=>m.properties.REGION4===r)};if(l.features.length===0)return;const i=_.geoJSON(l,{style:{color:"#1976d2",weight:.5,fillColor:"#64b5f6",fillOpacity:.15},interactive:!1}).addTo(t);return n.current=i,()=>{n.current&&(t.removeLayer(n.current),n.current=null)}},[r,t]),null}function He({selectedProvince:r}){const t=w(),n=a.useRef(null);return a.useEffect(()=>{if(n.current&&(t.removeLayer(n.current),n.current=null),!r)return;const l={type:"FeatureCollection",features:U(I,I.objects.data).features.filter(m=>m.properties.ADM1_TH===r)};if(l.features.length===0)return;const i=_.geoJSON(l,{style:{color:"#1976d2",weight:2,fillColor:"#64b5f6",fillOpacity:.25},interactive:!1}).addTo(t);return n.current=i,()=>{n.current&&(t.removeLayer(n.current),n.current=null)}},[r,t]),null}function Ze(){const r=w(),t=a.useRef(null);return a.useEffect(()=>{if(!r)return;t.current&&(r.removeLayer(t.current),t.current=null);const n=_.geoJSON(Ie,{style:{color:"#424242",weight:1.5,fillColor:"#ffff",fillOpacity:.1},interactive:!1});return n.addTo(r),t.current=n,()=>{t.current&&r.hasLayer(t.current)&&(r.removeLayer(t.current),t.current=null)}},[r]),null}function Ge({open:r,onClose:t,onOpen:n,station:o,getTemperatureInfo:l,getRainInfo:i}){function m(b){if(!b)return"ไม่มีข้อมูลเวลา";const p=new Date(b);if(isNaN(p.getTime()))return"รูปแบบเวลาไม่ถูกต้อง";const f=p.getDate(),j=p.getMonth()+1,C=p.getFullYear()+543,y=String(p.getHours()).padStart(2,"0"),v=String(p.getMinutes()).padStart(2,"0"),k=String(p.getSeconds()).padStart(2,"0");return`วันที่ ${f}/${j}/${C} เวลา ${y}:${v}:${k} น.`}const x=l==null?void 0:l(o==null?void 0:o.temperature),h=i==null?void 0:i(o==null?void 0:o.precip_today),u=(h==null?void 0:h.label)==="ฝนประปราย";return e.jsxs(ye,{anchor:"bottom",open:r,onClose:t,onOpen:n,swipeAreaWidth:56,disableEnforceFocus:!0,disableAutoFocus:!0,disableRestoreFocus:!0,PaperProps:{sx:{borderRadius:"20px 20px 0 0",boxShadow:"0 -8px 24px rgba(0,0,0,0.15)",display:"flex",flexDirection:"column"}},children:[e.jsx(s,{sx:{pt:1,pb:1,backgroundColor:"inherit"},children:e.jsx(s,{sx:{width:48,height:5,bgcolor:"grey.400",borderRadius:3,mx:"auto"}})}),e.jsx(s,{sx:{flex:1,minHeight:0,overflowY:"auto"},children:o?e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{px:2,py:2,background:"linear-gradient(135deg, #334155, #1e293b)",color:"white"},children:[e.jsx(d,{fontWeight:600,fontSize:16,children:o.station_name_th}),e.jsx(d,{fontSize:13,sx:{opacity:.9},children:m(o.datetime_utc7)})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,px:2},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(d,{fontSize:14,color:"text.secondary",children:"อุณหภูมิปัจจุบัน"}),e.jsxs(d,{fontSize:32,fontWeight:700,sx:{color:x==null?void 0:x.color},children:[o.temperature??"-","°C"]}),(x==null?void 0:x.label)&&e.jsx(B,{label:x.label,size:"small",sx:{mt:.5,bgcolor:`${x.color}22`,color:x.color,borderRadius:"5px",border:`1px solid ${x.color}55`,fontWeight:500,width:"fit-content"}})]}),e.jsxs(s,{textAlign:"right",children:[e.jsxs(d,{fontSize:14,color:"text.secondary",children:["อุณหภูมิสูงสุด:",e.jsxs(s,{component:"span",sx:{color:"red",fontWeight:600,ml:.5},children:[o.temperature_max_today??"-","°C"]})]}),e.jsxs(d,{fontSize:14,color:"text.secondary",children:["อุณหภูมิต่ำสุด:",e.jsxs(s,{component:"span",sx:{color:"rgb(0, 110, 255)",fontWeight:600,ml:.5},children:[o.temperature_min_today??"-","°C"]})]})]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",background:"linear-gradient(to right, #f1f5f9, #e2e8f0)",py:1.5,px:2},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(d,{fontSize:12,color:"text.secondary",children:"ฝน 15 นาที"}),e.jsxs(d,{fontWeight:600,children:[o.precip_15mins??"-"," มม."]}),(h==null?void 0:h.label)&&e.jsx(B,{label:`วันนี้: ${h.label}`,size:"small",sx:{mt:.5,color:u?"#000000":h.color,backgroundColor:u?"#e0e0e0":`${h.color}22`,border:u?"1px solid #bdbdbd":`1px solid ${h.color}55`,borderRadius:"5px",fontWeight:500,width:"fit-content"}})]}),e.jsxs(s,{textAlign:"right",children:[e.jsx(d,{fontSize:12,color:"text.secondary",children:"ฝนสะสมวันนี้ (ตั้งแต่07:00 น.)"}),e.jsxs(d,{fontWeight:600,children:[o.precip_today??"-"," มม."]})]})]}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1,textAlign:"center",py:1.5},children:[e.jsxs(s,{children:[e.jsx(d,{fontSize:12,color:"text.secondary",children:"ลม"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.1},children:[o.winddirection!=null&&e.jsx(s,{sx:{transform:`rotate(${(o.winddirection+180)%360}deg)`,transition:"transform 0.2s ease",display:"flex"},children:e.jsx(V,{size:15})}),e.jsxs(d,{fontWeight:600,children:[o.windspeed??"-"," กม./ชม."]})]})]}),e.jsxs(s,{children:[e.jsx(d,{fontSize:12,color:"text.secondary",children:"ความกดอากาศ"}),e.jsxs(d,{fontWeight:600,children:[o.pressure??"-"," hPa"]})]}),e.jsxs(s,{children:[e.jsx(d,{fontSize:12,color:"text.secondary",children:"ความชื้น"}),e.jsxs(d,{fontWeight:600,children:[o.humidity??"-"," %"]})]})]}),e.jsx(s,{sx:{textAlign:"center",mt:.5,backgroundColor:"#f8fafc",py:1},children:e.jsx(J,{to:`/awsmap/stations/${o.station_id}`,target:"_blank",style:{textDecoration:"none",color:"#64748b"},children:"ดูข้อมูลสถานีเพิ่มเติม →"})})]}):e.jsx(d,{fontSize:14,color:"text.secondary",children:"ไม่มีข้อมูลสถานี"})})]})}function Je(){return e.jsx(s,{sx:{position:"absolute",inset:0,zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255,255,255,0.7)"},children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(Se,{size:48,thickness:4,color:"primary"}),e.jsx(s,{sx:{mt:1,fontSize:14},children:"กำลังโหลดข้อมูล..."})]})})}function Ue({error:r}){return e.jsx(s,{sx:{position:"absolute",inset:0,zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:e.jsxs(s,{sx:{bgcolor:"rgba(255,255,255,0.95)",border:"1px solid",borderColor:"error.main",borderRadius:2,px:3,py:2,boxShadow:3,display:"flex",alignItems:"center",gap:1.5,maxWidth:320},children:[e.jsx(we,{sx:{color:"error.main",fontSize:32}}),e.jsxs(s,{children:[e.jsx(s,{sx:{fontWeight:600,color:"error.main",lineHeight:1.2},children:"เกิดข้อผิดพลาด"}),e.jsx(s,{sx:{fontSize:14,color:"text.secondary"},children:r})]})]})})}function Ke(){const r=[13.7563,100.5018],[t,n]=a.useState([]),[o,l]=a.useState(""),[i,m]=a.useState(null),[x,h]=a.useState(null),[u,b]=a.useState(!1),[p,f]=a.useState(!0),[j,C]=a.useState(null),[y,v]=a.useState(null),[k,Y]=a.useState("rain"),[M,K]=a.useState("osm"),[Q,D]=a.useState(!0),[q,X]=a.useState(!1),N=a.useRef(null),ee=[[1,92],[28.5,110.5]],re=Ce(),g=ve(re.breakpoints.down("sm")),W=async()=>{var c;try{f(!0),v(null);const S=await Ne.get("https://wxmap.tmd.go.th/api/awsnow");(c=S.data)!=null&&c.success?(n(S.data.data),C(new Date)):v("ไม่สามารถโหลดข้อมูลสภาพอากาศได้")}catch(S){console.error("Fetch error:",S),v("ขัดข้องในการเชื่อมต่อ API")}finally{f(!1)}};a.useEffect(()=>{W()},[]),a.useEffect(()=>{D(!g)},[g]);const te=a.useMemo(()=>Array.from(new Set(t.map(c=>c.region_name_th))),[t]);a.useEffect(()=>{if(!N.current)return;const c=g?5.3:6;N.current.setMinZoom(c),N.current.setZoom(c,{animate:!1})},[g]);const oe=a.useMemo(()=>Array.from(new Set(t.filter(c=>!o||c.region_name_th===o).map(c=>c.province_name_th))).sort((c,S)=>c.localeCompare(S,"th")),[t,o]),ne=a.useMemo(()=>t.filter(c=>i?c.province_name_th===i:o?c.region_name_th===o:!0),[t,o,i]);return e.jsxs(s,{sx:{height:"100vh",width:"100%",position:"relative"},children:[p&&e.jsx(Je,{}),e.jsx(Me,{isMobile:g,mobileSearchOpen:q,setMobileSearchOpen:X,lastUpdated:j,loading:p,onRefresh:W,regions:te,selectedRegion:o,setSelectedRegion:l,filteredProvinces:oe,selectedProvince:i,setSelectedProvince:m}),e.jsx(Re,{displayMode:k,setDisplayMode:Y,open:Q,setOpen:D}),!p&&e.jsxs(ke,{center:r,zoom:g?5.3:6,minZoom:g?5.3:6,maxZoom:12,maxBounds:ee,maxBoundsViscosity:.9,zoomControl:!1,keyboard:!1,whenReady:c=>{N.current=c.target},style:{height:"100%",width:"100%"},children:[e.jsx(We,{basemap:M}),ne.map(c=>e.jsx(ze,{center:[c.station_lat,c.station_lon],radius:7,pathOptions:{fillColor:k==="rain"?T(c.precip_today).color:O(c.temperature).color,fillOpacity:.85,stroke:!0,color:"#5b5a5a",weight:1},eventHandlers:{click:()=>{g&&(h(c),b(!0))}},children:!g&&e.jsx(_e,{className:"custom-popup",children:e.jsx(Oe,{station:c,getTemperatureInfo:O,getRainInfo:T})})},c.station_id)),e.jsx(Be,{stations:t,selectedRegion:o,selectedProvince:i,isMobile:g}),e.jsx(Ae,{stations:t,selectedProvince:i}),e.jsx(Ze,{}),o&&!i&&e.jsx(Pe,{selectedRegion:o}),i&&e.jsx(He,{selectedProvince:i})]}),y&&!p&&e.jsx(Ue,{error:y}),e.jsx(Ee,{mode:k,isMobile:g}),e.jsx($e,{basemap:M,isMobile:g,setBasemap:K}),g&&e.jsx(Ge,{open:u,onClose:()=>b(!1),onOpen:()=>b(!0),getTemperatureInfo:O,getRainInfo:T,station:x})]})}export{Ke as default};
